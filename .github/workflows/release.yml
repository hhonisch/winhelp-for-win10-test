name: Create Release

on:
  push:
    # Sequence of patterns matched against refs/tags
    tags:
      - 'v*' # Push events to matching v*, i.e. v1.0, v20.15.10

jobs:
  release:
    runs-on: windows-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v2

      - name: Run build helper
        run: .\build\github_build_helper.ps1

      - name: Add msbuild to PATH
        uses: microsoft/setup-msbuild@v1.0.2

       - name: Compile
         run: .\build\build.bat
         shell: cmd

       - name: Create Release
         id: create_release
         uses: actions/create-release@v1
         env:
           GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
         with:
           tag_name: ${{ github.ref }}
           release_name: Release ${{ env.MY_VERSION }}
           body_path: RELEASE_NOTES.md
           draft: true
           prerelease: true

       - name: Upload Release Asset
         id: upload-release-asset
         uses: actions/upload-release-asset@v1
         env:
           GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
         with:
           upload_url: ${{ steps.create_release.outputs.upload_url }} 
           asset_path: .\dist\Setup_WinHelp4Win10.exe
           asset_name: WinHelp4Win10-${{ env.MY_VERSION }}.exe
           asset_content_type: application/octet-stream
